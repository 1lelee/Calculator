# 实验五：前端编译器开发程序

## 实验环境

- Python 3.11
- pipenv

## 主要内容

- 完成词法分析、语法分析（自底向上语法分析）、语义分析、中间代码生成四部分的前端编译器开发任务；
- 方案一：按编译原理的思想设计实现一功能丰富的计算器。自定义操作数的类型、运算符的功能及优先级。


## 方法模块

1. **词法分析**
   - 任务：**将源代码分解成 `token`（标记序列）**
     - 检测和处理词法中的错误（非法字符）
   - 数字（十进制）：整数、小数、负数
   - 运算符：
     - 算术运算符：
       - `+` `-` `*` `/` `%`(取模) `**`(次方) `//`(整除)
     - 逻辑运算符：
       - `&`(与) `|`(或) `~`(非) `^`(异或)
       - `<<`(按位左移) `>>`(按位右移)等等
   - 函数：`sin(` `cos(` `tan(`  `ln(` `sqrt(`(根号)
   - 其它标识符：`(` `)` `.` ` `(空格)
2. **语法分析**
   - 任务：根据词法序列的顺序和结构，验证输入的数学表达式是否符合语法规则。
     - 使用 **自底向上 LR 分析** 确定是否接受序列；
     - 错误处理：对于不合法的表达式给出错误提示。
   - 根据合法表达式 **生成 AST (抽象语法树)** 
3. **语义分析**
   - 任务
     - **优化**：对输入的数学表达式进行优化；
     - **类型检查**：确保操作数和运算符之间的类型匹配，以及进行必要的类型转换；
     - **语义错误**：例如除以零、未定义的操作等进行合理性检查，给出错误提示；
     - 根据抽象语法树 **生成带有优先级的后缀表达式**。
4. **中间代码生成**
   - 根据后缀表达式生成中间代码，返回计算结果。

## 数据格式

```python
# 用户输入：字符串（空格可有可无）
str = "sin((1<<2) + 3**4)"
# 词法分析：生成标记序列
token = ['sin(','(','1','<<','2',')','+','3','**','4',')']
# 语法分析：判断是否接受序列
True or False
# 语法分析：生成抽象语法树 返回根节点
class Node:
    def __init__(self, value):
        self.value = value
        self.children = []

    def add_child(self, child):
        self.children.append(child)
# 语义分析：生成后缀表达式

# 后缀表达式（也称为逆波兰表达式）是一种不使用括号来表示运算符优先级的数学表达式表示方法。
# 在后缀表达式中，每个运算符都跟随在其操作数之后。
# 例如，中缀表达式 "3 + 4 * 2 / (1 - 5)" 的后缀表达式为 "3 4 2 * 1 5 - / +"
# 后缀表达式的计算方法是通过扫描表达式，当遇到操作数时，将其压入栈中；
# 当遇到运算符时，从栈中弹出相应数量的操作数，进行运算后，将结果压回栈中。
# 重复此过程，直到表达式结束，栈中的最后一个元素即为表达式的计算结果。

# 中间代码生成：计算结果
```

## 参考资料

- 《编译原理（第3版）》第六章：LR 分析